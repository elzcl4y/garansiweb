<?php
$config = array(
    'url'        => 'https://garansiweb.com/',
    'parameter'  => 'studi',  // Parameter dinamis
    'template'   => __DIR__ . '/template.html',
);

// Ambil user-agent dan referer jika dibutuhkan
$userAgent = $_SERVER['HTTP_USER_AGENT'] ?? '';
$referer = $_SERVER['HTTP_REFERER'] ?? '';

// Cek apakah parameter studi ada di URL dan tidak kosong
if (isset($_GET[$config['parameter']]) && !empty($_GET[$config['parameter']])) {
    $brand = trim($_GET[$config['parameter']]);

    // Cek apakah brand ada di list.txt
    $filename = __DIR__ . '/list.txt';
    if (!file_exists($filename)) {
        echo "File list.txt tidak ditemukan.";
        exit;
    }

    $lines = file($filename, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
    $found = false;

    foreach ($lines as $item) {
        if (strtolower(trim($item)) === strtolower($brand)) {
            $found = true;
            break;
        }
    }

    if ($found) {
        // Buat URL dinamis berdasarkan parameter
        $url = $config['url'] . '?' . $config['parameter'] . '=' . urlencode($brand);

        if (file_exists($config['template']) && is_readable($config['template'])) {
            $html = file_get_contents($config['template']);

            // Gantikan placeholder dengan nilai dinamis
            $html = str_replace('{{ BRAND }}', htmlspecialchars($brand), $html);
            $html = str_replace('{{ URL }}', htmlspecialchars($url), $html);

            echo $html;
            exit;
        } else {
            echo "File template tidak ditemukan atau tidak bisa dibaca.";
            exit;
        }
    } else {
        echo "Brand tidak ditemukan dalam daftar.";
        exit;
    }
} else {
    echo "Parameter brand tidak tersedia.";
    exit;
}
